---
title: "hw3_tpd2121"
output: github_document
date: "2024-10-12"
---

Initializing the packages
```{r initial}
library(tidyverse)
library(ggridges)
```

## Problem 2

Loading the dataset
```{r dataset}
demography = read.csv("./nhanes_covar.csv", 
                      skip = 4) %>% 
  drop_na()
acc_data = read.csv("./nhanes_accel.csv")
```

Cleaning the dataset
```{r cleaning}
#checking data
anti_join(demography, acc_data)

#joining the dataset
complete_acc = 
  full_join(demography, acc_data, by = "SEQN") %>% 
  filter(age >21) %>% 
  mutate(
    sex = as.character(sex),
    sex = case_match(
      sex,
      "1" ~ "male",
      "2" ~ "female"), 
    education = as.character(education),
    education = case_match(
      education,
      "1" ~ "Less than highschool",
      "2" ~ "Highschool equivalent",
      "3" ~ "More than highschool"
    )
  )
```

Creating table and visualization for gender, education, and age
```{r table}
complete_acc %>% 
  group_by(sex, education) %>% 
  summarize(count = n()) %>% 
  pivot_wider(names_from = "education", values_from = "count") %>% 
  knitr::kable()
```

```{r visualization}
complete_acc %>% 
  group_by(sex, education, age) %>% 
  ggplot(aes(x = education, y = age, color = sex)) + 
  geom_boxplot() + 
  labs(
    title = "Age distribution based on education and sex")
```

**Total activity over the day**

```{r total}
total_df = 
  complete_acc %>% 
  mutate(
    act_total = rowSums(across(c(min1:min1440)))
    )%>% 
  select(SEQN:education, act_total)
```

```{r total_plot}
ggplot(total_df, aes(x = age, y = act_total, color = sex)) + 
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) + 
  facet_grid(. ~ education) + 
  theme_bw() +
  labs(
    title = "Total physical activity based on age, education, and sex",
    y = "Total physical activity per day")
#do facet_grid (sex ~ education) if want to make 6 panel
```

Based on the plot, we can see that there is a difference in the total activity based on age, education, and sex. For people who had education lower than highschool equivalent, the highest total activity per day is recorded at 30-50 years old group and decline afterwards. Female are shown to have higher activies per day compared to male in this group. People who have highschool equivalent education generally show decreasing trend of physical activity as they got older. This decline is more pronounced in female compared to male participants. There's a jump in activities recorded around 50 to 60 years of age, before declining again. Lastly, in the people with higher than highschool education, female participants' have plateauing activities until age 60 before declining. In male participants, there's a slight dip from around age 20s to 40s, before slightly jumping up and declining again at around age 50. 

**3 panel plot**
Accelerometer data allows the inspection activity over the course of the day. Make a three-panel plot that shows the 24-hour activity time courses for each education level and use color to indicate sex. Describe in words any patterns or conclusions you can make based on this graph; including smooth trends may help identify differences.
x axis = minutes, y axis = mean activity, color line = sex, panel = education

```{r time-course}
timecourse_df = 
  complete_acc %>% 
  select(-SEQN, -BMI, -age) %>% 
  group_by(sex, education) %>% 
  summarize(across(min1:min1440, mean)) %>% 
  pivot_longer(
    min1:min1440,
    names_to = "minutes",
    values_to = "activity"
    )
```

```{r timecourse_plot}
ggplot(timecourse_df, aes(x = minutes, y = activity, color = sex)) + 
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) + 
  facet_grid(education ~ .) + 
  theme_bw()

#pretty sure have to convert the minutes to hours, then plot the hours to the data
```

##Problem 3
