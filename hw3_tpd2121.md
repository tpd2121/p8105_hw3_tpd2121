hw3_tpd2121
================
2024-10-12

Initializing the packages

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(ggridges)
```

## Problem 2

2A. Loading the dataset

``` r
demography = read.csv("./nhanes_covar.csv", 
                      skip = 4) %>% 
  drop_na()
acc_data = read.csv("./nhanes_accel.csv")
```

Cleaning the dataset

``` r
#checking data
anti_join(demography, acc_data)
```

    ## Joining with `by = join_by(SEQN)`

    ## [1] SEQN      sex       age       BMI       education
    ## <0 rows> (or 0-length row.names)

``` r
#joining the dataset
complete_acc = 
  full_join(demography, acc_data, by = "SEQN") %>% 
  filter(age >21) %>% 
  mutate(
    sex = as.character(sex),
    sex = case_match(
      sex,
      "1" ~ "male",
      "2" ~ "female"), 
    education = as.character(education),
    education = case_match(
      education,
      "1" ~ "Less than highschool",
      "2" ~ "Highschool equivalent",
      "3" ~ "More than highschool"
    )
  )
```

2B. Creating table and visualization for gender, education, and age

``` r
complete_acc %>% 
  group_by(sex, education) %>% 
  summarize(count = n()) %>% 
  pivot_wider(names_from = "education", values_from = "count") %>% 
  knitr::kable()
```

    ## `summarise()` has grouped output by 'sex'. You can override using the `.groups`
    ## argument.

| sex    | Highschool equivalent | Less than highschool | More than highschool |
|:-------|----------------------:|---------------------:|---------------------:|
| female |                    23 |                   28 |                   59 |
| male   |                    34 |                   27 |                   54 |

``` r
complete_acc %>% 
  group_by(sex, education, age) %>% 
  ggplot(aes(x = education, y = age, color = sex)) + 
  geom_boxplot() + 
  labs(
    title = "Age distribution based on education and sex")
```

![](hw3_tpd2121_files/figure-gfm/visualization-1.png)<!-- -->

2C. Total activity over the day

``` r
total_df = 
  complete_acc %>% 
  mutate(
    act_total = rowSums(across(c(min1:min1440)))
    )%>% 
  select(SEQN:education, act_total)
```

``` r
ggplot(total_df, aes(x = age, y = act_total, color = sex)) + 
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) + 
  facet_grid(. ~ education) + 
  theme_bw() +
  labs(
    title = "Total physical activity based on age, education, and sex",
    y = "Total physical activity per day")
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](hw3_tpd2121_files/figure-gfm/total_plot-1.png)<!-- -->

``` r
#do facet_grid (sex ~ education) if want to make 6 panel
```

Based on the plot, we can see that there is a difference in the total
activity based on age, education, and sex. For people who had education
lower than highschool equivalent, the highest total activity per day is
recorded at 30-50 years old group and decline afterwards. Female are
shown to have higher activies per day compared to male in this group.
People who have highschool equivalent education generally show
decreasing trend of physical activity as they got older. This decline is
more pronounced in female compared to male participants. There’s a jump
in activities recorded around 50 to 60 years of age, before declining
again. Lastly, in the people with higher than highschool education,
female participants’ have plateauing activities until age 60 before
declining. In male participants, there’s a slight dip from around age
20s to 40s, before slightly jumping up and declining again at around age
50.

2D. 3 panel plot Accelerometer data allows the inspection activity over
the course of the day. Make a three-panel plot that shows the 24-hour
activity time courses for each education level and use color to indicate
sex. Describe in words any patterns or conclusions you can make based on
this graph; including smooth trends may help identify differences. x
axis = minutes, y axis = mean activity, color line = sex, panel =
education

``` r
timecourse_df = 
  complete_acc %>% 
  select(-SEQN, -BMI, -age) %>% 
  group_by(sex, education) %>% 
  summarize(across(min1:min1440, mean)) %>% 
  pivot_longer(
    min1:min1440,
    names_to = "minutes",
    values_to = "activity"
    )
```

    ## `summarise()` has grouped output by 'sex'. You can override using the `.groups`
    ## argument.

``` r
ggplot(timecourse_df, aes(x = minutes, y = activity, color = sex)) + 
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) + 
  facet_grid(education ~ .) + 
  theme_bw()
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](hw3_tpd2121_files/figure-gfm/timecourse_plot-1.png)<!-- -->

``` r
#pretty sure have to convert the minutes to hours, then plot the hours to the data
```

## Problem 3

3A. Load and clean the data

``` r
jan_2020 = read.csv("./Jan 2020 Citi.csv") %>% 
  janitor::clean_names() %>%
  mutate(time = "jan_20") %>% 
  select(time, everything())

jan_2024 = read.csv("./Jan 2024 Citi.csv") %>% 
  janitor::clean_names() %>%
  mutate(time = "jan_24") %>% 
  select(time, everything())

jul_2020 = read.csv("./July 2020 Citi.csv") %>% 
  janitor::clean_names() %>%
  mutate(time = "jul_20") %>% 
  select(time, everything())

jul_2024 = read.csv("./July 2024 Citi.csv") %>% 
  janitor::clean_names() %>%
  mutate(time = "jul_24") %>% 
  select(time, everything())

citibike_df = 
  bind_rows(jan_2020, jan_2024, jul_2020, jul_2024)
```

There are 4 data set in the citibike folder. The January 2020 data
contains 12420, while the January 2024 data contains 18861 observations.
Meanwhile, the July 2020 data contains 21048 while the July 2024
contains 47156 observations. The variables on all data frame are quite
similar, which are time, ride_id, rideable_type, weekdays, duration,
start_station_name, end_station_name, member_casual, with the variable
`time` is an additional variable I created to help with merging the data
into `citibike_df`.

3B. Reader friendly table

``` r
citibike_df %>% 
  group_by(time, member_casual) %>% 
  summarize(count = n()) %>% 
  pivot_wider(names_from = "time", values_from = "count") %>% 
  knitr::kable()
```

    ## `summarise()` has grouped output by 'time'. You can override using the
    ## `.groups` argument.

| member_casual | jan_20 | jan_24 | jul_20 | jul_24 |
|:--------------|-------:|-------:|-------:|-------:|
| casual        |    984 |   2108 |   5637 |  10894 |
| member        |  11436 |  16753 |  15411 |  36262 |

From this table, we can see that in citibike members have higher
ridership compared to casual riders from these 4 timepoints. We also see
that while member ridership are increasing, the casual riders have a
steep drop from `jul_20` to `jan_24`.

3C. 5 popular stations Make a table showing the 5 most popular starting
stations for July 2024; include the number of rides originating from
these stations.

``` r
jul_2024 %>% 
  group_by(start_station_name) %>% 
  summarise(count = n())
```

    ## # A tibble: 2,057 × 2
    ##    start_station_name count
    ##    <chr>              <int>
    ##  1 1 Ave & E 110 St      33
    ##  2 1 Ave & E 118 St      21
    ##  3 1 Ave & E 16 St       73
    ##  4 1 Ave & E 18 St       75
    ##  5 1 Ave & E 30 St       57
    ##  6 1 Ave & E 38 St       78
    ##  7 1 Ave & E 39 St       68
    ##  8 1 Ave & E 44 St       17
    ##  9 1 Ave & E 6 St        85
    ## 10 1 Ave & E 62 St       79
    ## # ℹ 2,047 more rows

``` r
  #rank function? and then make the plot
```

3D. Plot Make a plot to investigate the effects of day of the week,
month, and year on median ride duration. This plot can include one or
more panels, but should facilitate comparison across all variables of
interest. Comment on your observations from this plot.

``` r
citibike_df %>% 
  group_by(time, weekdays) %>% 
  summarise(
    median = median(duration, na.rm = TRUE)) %>% 
  ggplot(aes(x = weekdays, y = median)) + 
  geom_point(aes(color = time), alpha = .5) +
  geom_smooth(se = FALSE) + 
  theme_bw()
```

    ## `summarise()` has grouped output by 'time'. You can override using the
    ## `.groups` argument.
    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](hw3_tpd2121_files/figure-gfm/ride%20median-1.png)<!-- -->

``` r
#the trendline is missing
#x axis sorted alphabetically, not days in orders
```

From the plot, we can see that Jul 2020 has the highest ridership median
compared to the other month-year timepoint. When looking at the days, we
see that Saturdays generally have the highest median across all
month-year time points.

3E. Electric bikes

``` r
citibike_df %>% 
  group_by(time, rideable_type, member_casual) %>%
  select(time, rideable_type, member_casual, duration) %>% 
  filter(time %in% c("jan_24", "jul_24")) %>% 
  ggplot(aes(x = duration, fill = rideable_type)) + 
  geom_histogram(position = "dodge", binwidth = 2) + 
  facet_grid(member_casual ~ time)
```

![](hw3_tpd2121_files/figure-gfm/electric-1.png)<!-- --> I used
univariate plot, in this case histogram, since only 1 variable is
numerical variable. Based on the plot, we can see that members always
have higher ridership compared to casual riders and electric bikes have
higher ridership compared to non-electric bikes. In terms of duration,
Jul 2024 have longer ride duration for both members and casual riders
compared to Jan 2024.
